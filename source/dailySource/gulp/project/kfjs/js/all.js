function getJsEntry(){var e=glob.sync(config.jsEntry),s={};return(e||[]).forEach(function(e,n){entryForString(s,e,n)}),s}function entryForString(e,s,n){var i=/(.*)\/([^\/]+)$/,r=s.replace(/^\.\//,"").match(i);r.length<3&&(gutil.log(gutil.colors.red("第 "+(n+1)," 个js配置的路径有问题")),process.exit(1));var t=s.replace(/(\.\/)?src\/|(\.entry)?\.js/g,"");e[t]=s}function getWebpackCompiler(e){return webpackCompiler({entry:getJsEntry(),outputPath:config.dest,filename:"[name].js",base:__dirname},e)}function outputBuildStats(e,s){e?console.log(e):console.log(s.toString({hash:!1,version:!1,colors:!0}))}$(function(){function e(e){var s=/^[0-9a-zA-Z]{6,16}$/;return!!s.test(e)}$("#password").keyup(function(){var s=$("#password").val().trim();e(s)?$("#password").css("background-color","#fff"):$("#password").css("background-color","#fff")}),$("#repeat_pwd").keyup(function(){var e=$("#password").val().trim(),s=$("#repeat_pwd").val().trim();s!==e?$("#repeat_pwd").css("background-color","#fff"):$("#repeat_pwd").css("background-color","#fff")}),$(".form").keyup(function(){var s=$("#password").val().trim(),n=$("#repeat_pwd").val().trim();e(s)&&e(n)&&n==s?$("button").removeClass("disabled").addClass("btn"):$("button").removeClass("btn").addClass("disabled")})}),$(function(){var e=function(){var e=$("input.number-content").val().trim();$("input.number-content").val().length,$("div.new-area").css("display").trim(),$("div.join-state").css("display").trim();$("input.number-content").val(e.replace(/\D+/g,"")),isMobel(e)?($(".H_GetVerifyCode").attr("hyb-data-mobile",e),$(".H_LoginBtn").text("下一步"),$("input.number-content").css("background-color","#fff"),$("span.logo").css("background-image","url(/images/index/loading.gif)"),HYB.request({url:"/index/checkMobileLoginOrReg",data:"mobile="+e,needLoading:!1,callFunc:function(e){var s="";0==e?s="old":10013==e||10010==e?s="new":10018==e&&(s="blacklist"),"new"==s?($("div.agreement-area").show(),$("div.join-state").slideUp(),$("#header-hide").css("display","block"),$("div.new-area").slideDown(),$("span.logo").css("background-image","url(/images/index/tip_right.png)"),$(".H_VerifyCode").val(""),$(".H_GetVerifyCode").val("获取").removeClass("disabled").addClass("enabled"),$(".H_LoginBtn").text("注册")):"old"==s?($("div.old-area").slideDown(),$("span.logo").css("background-image","none"),$(".H_LoginBtn").text("登录"),$("div.agreement-area").hide()):"blacklist"==s&&($("span.logo").css("background-image","none"),new TipBox({str:"您输入的手机号存在风险！<br/>请联系客服",image:"<img src='/images/index/tip.png' />",btnCount:1}))}})):($("span.logo").css("background-image","none"),$(".H_GetVerifyCode").val("获取").removeClass("disabled").addClass("enabled"),$("div.new-area").slideUp(),$("div.old-area").slideUp(),$("input.number-content").css("background-color","#fff"),$("#old-password").val(""),$("#new-password").val(""),$(".H_LoginBtn").text("下一步"))};e();var s=function(){var e=!1,s=$("input.number-content").val().trim();if(isMobel(s))if("none"==$(".H_NewUser").css("display")){var n=$("#old-password").val().trim();checkPassword(n)&&(e=!0)}else if("none"==$(".H_OldUser").css("display")){var i=$(".H_AgreeProtocol").prop("checked");if(i){var n=$("#new-password").val().trim(),r=$("input.message-area").val().trim();checkVerifyCode(r)&&checkPassword(n)&&(e=!0)}}e?$(".H_LoginBtn").addClass("enabled enabledyear").removeClass("disabled"):$(".H_LoginBtn").addClass("disabled").removeClass("enabled enabledyear")};$("div.insert-area").on("keyup",function(){s()}),HYB.clickEventListener(".H_LoginBtn",function(e){if("none"==$(".H_NewUser").css("display")){var s=$("#old-password").val().trim(),n=$("input.number-content").val().trim();HYB.request({url:"/index/toVerified",data:"pwd="+hex_sha1(s)+"&mobile="+n,callFunc:function(s){if(0==s){var n=$("#redirectUri").val();""!=n?window.location.href=n:window.location.href="/verified/index"}else HYB.loadingComplete(e),$("#old-password").val("").focus(),e.addClass("disabled").removeClass("enabled"),-1==s?new TipBox({str:"账户已被锁定，建议您点击“忘记密码”进行密码重置",image:"<img src='/images/index/error.png' />",btnCount:1}):-2==s?new TipBox({str:"密码输入错误达到两次，一小时内您还有一次机会",image:"<img src='/images/index/tip.png' />",btnCount:1}):-3==s?new TipBox({str:"请一小时后再试，建议您点击“忘记密码”进行密码重置",image:"<img src='/images/index/tip.png' />",btnCount:1}):10010==s?new TipBox({str:"登录密码不正确，请重新输入",image:"<img src='/images/index/tip.png' />",btnCount:1}):showMessage(s,"登录失败")},obj:e,onlyOnce:!0})}else if("none"==$(".H_OldUser").css("display")){var s=$("#new-password").val().trim(),i=$("input.message-area").val().trim(),n=$("input.number-content").val().trim(),r=$("#source").val().trim(),t=$("#invite").val();HYB.request({url:"/index/createUser",data:"pwd="+hex_sha1(s)+"&verifyCode="+i+"&inviteCode="+t+"&mobile="+n+"&source="+r,callFunc:function(e){0==e?new TipBox({str:"恭喜您！注册成功",image:"<img src='/images/index/tip_right.png' />",btnCount:1,callBack:function(){window.location.href="/verified/index?isNew=true"}}):-1==e?showAlert("请求过于频繁，已被系统自动锁定1小时"):showMessage(e,"注册失败")},obj:e})}}),HYB.clickEventListener(".H_AgreeProtocol",function(e){s()},!1),$("input.number-content").bind("input propertychange",function(){e()}),$("a.help").click(function(){new TipBox({str:'<div class="invite-area"><h5  class="invite-title">什么是邀请码？</h5><p class="invitecode-state">邀请码为每位注册用户手机号码后8位，注册时填写好友邀请码，双方都可获得更多奖励。</p></div>',btnCount:1}),$("div.icon").hide()})});var path=require("path"),fs=require("fs"),gulp=require("gulp"),gutil=require("gulp-util"),rename=require("gulp-rename"),plumber=require("gulp-plumber"),concat=require("gulp-concat"),postcss=require("gulp-postcss"),less=require("gulp-less"),reporter=require("gulp-less-reporter"),sourcemaps=require("gulp-sourcemaps"),webpackCompiler=require("./build/webpack"),postcssPluins=require("./build/postcss"),glob=require("glob"),del=require("del"),runSequence=require("run-sequence"),config={domain:"//i.epay.126.net/m/f/",dest:"./dist",dev:"./dev",dist:"./dist",src:"./src",jsEntry:"./src/js/**/*.entry.js",less:"src/less/**",lessEntry:"./src/less/**/*.entry.less",image:"src/images/**",assets:["src/font/**"],vendorJs:"src/js/gallery/**/*.js"};gulp.task("build:js",function(e){getWebpackCompiler(mode).run(function(s,n){outputBuildStats(s,n),e()})}),gulp.task("watch:js",function(){getWebpackCompiler(mode).watch({aggregateTimeout:1e3},outputBuildStats)}),gulp.task("build:less",function(){var e=less({paths:["./src/less"]}).on("error",reporter),s=[postcssPluins.postcssUrl,postcssPluins.pxtorem,postcssPluins.autoprefixer,postcssPluins.csswring],n=gulp.src(config.lessEntry).pipe(plumber()).pipe(sourcemaps.init()).pipe(e).pipe(postcss(s)).pipe(rename(function(e){e.basename=e.basename.replace(".entry","")}));return"dev"===mode&&(n=n.pipe(sourcemaps.write())),n.pipe(gulp.dest(config.dest+"/css"))}),gulp.task("watch:less",["build:less"],function(){gulp.watch(config.less,["build:less"])}),gulp.task("build:img",function(){return gulp.src(config.image).pipe(gulp.dest(config.dest+"/images"))}),gulp.task("watch:img",["build:img"],function(){gulp.watch(config.images,["build:img"])}),gulp.task("build:js-vendor",function(){return gulp.src(config.vendorJs).pipe(concat("verdor.js")).pipe(gulp.dest(config.dest+"/js/gallery"))}),gulp.task("assets",function(){return gulp.src(config.assets,{base:"src/"}).pipe(gulp.dest(config.dest))});var mode;gulp.task("dev-mode",function(){mode="dev",config.dest=config.dev}),gulp.task("clean",function(){return del([config.dest+"/**"])}),gulp.task("build",["assets","build:img","build:less","build:js-vendor","build:js"]),gulp.task("default",function(e){runSequence("dev-mode","clean",["assets","watch:img","watch:less","build:js-vendor","watch:js"],e)}),gulp.task("dev",function(e){runSequence("dev-mode","clean","build",e)}),gulp.task("dist",function(e){runSequence("clean","build",e)});